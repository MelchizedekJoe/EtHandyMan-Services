<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ET Handyman Services | Brighton & Peacehaven</title>
<meta name="description" content="ET Handyman Services — roofing, tiling, driveways, landscaping, painting, flooring and plumbing across Brighton, Hove & Peacehaven." />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

<style>
:root{
  --bg:#0f172a; --fg:#e5e7eb; --muted:#a7b0c0;
  --border:rgba(255,255,255,.09); --glass:rgba(255,255,255,.06);
  --shadow:0 16px 32px rgba(0,0,0,.45); --accent:#38bdf8; --header-h:64px;
}
*{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Ubuntu,Arial;
  background:radial-gradient(1200px 700px at 50% 0%, #111827 0%, var(--bg) 55%);
  color:var(--fg); -webkit-text-size-adjust:100%;
}

/* ===== Header ===== */
.header{position:fixed;inset:0 0 auto 0;z-index:1000;background:rgba(7,12,24,.78);backdrop-filter:blur(10px);border-bottom:1px solid var(--border)}
.wrap{max-width:1200px;margin:auto;padding:10px 16px;display:flex;align-items:center;gap:12px}
.brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:16px;letter-spacing:.02em}
.brand-logo{width:28px;height:28px;object-fit:contain;border-radius:6px;box-shadow:0 0 0 1px rgba(255,255,255,.15),0 4px 10px rgba(0,0,0,.35)}
nav{display:flex;align-items:center;gap:8px}
nav a{color:inherit;text-decoration:none;margin:0 8px;padding:6px 0;border-bottom:2px solid transparent;transition:.2s}
nav a:hover{border-bottom-color:rgba(255,255,255,.35)}
.spacer{flex:1}
.cta{display:inline-flex;align-items:center;gap:8px;padding:.55rem .9rem;border-radius:9999px;border:1px solid var(--border);background:var(--glass);text-decoration:none;color:inherit}
.menu-btn{display:none;border:1px solid var(--border);background:var(--glass);border-radius:10px;padding:.5rem .7rem;cursor:pointer}
.menu-btn svg{width:22px;height:22px}

/* ===== Layout ===== */
.hero,.section{scroll-margin-top:calc(var(--header-h) + 10px)}
.section{max-width:1200px;margin:40px auto;padding:0 16px}
.section h2{margin:0 0 8px;font-size:clamp(22px,3.6vw,34px)}
.muted{color:var(--muted);margin:0 0 18px}

/* ===== Hero ===== */
.hero{max-width:1200px;margin:24px auto;padding:0 16px;display:grid;grid-template-columns:1.1fr .9fr;gap:20px;align-items:center}
.hero h1{font-size:clamp(26px,5vw,46px);margin-bottom:.6rem}
.hero p{color:var(--muted);margin-bottom:1rem}
.buttons{display:flex;gap:10px;flex-wrap:wrap}
.btn{padding:.78rem 1rem;border-radius:12px;border:1px solid var(--border);text-decoration:none;color:inherit;background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.25));box-shadow:var(--shadow)}
.btn.primary{background:linear-gradient(180deg,rgba(56,189,248,.25),rgba(0,0,0,.25));border-color:rgba(56,189,248,.35)}
.heroCard{background:var(--glass);border:1px solid var(--border);border-radius:18px;box-shadow:var(--shadow);overflow:hidden}
.heroImg{width:100%;height:320px;object-fit:cover;background:#1f2937;display:block}

/* ===== Services ===== */
.grid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.card{background:var(--glass);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow)}
.svc{padding:14px;display:grid;grid-template-columns:72px 1fr;gap:12px;align-items:center}
.svc img{width:72px;height:72px;border-radius:12px;object-fit:cover;background:#1f2937}
.svc h3{margin:0 0 4px;font-size:18px}
.svc p{margin:0;color:var(--muted);font-size:14px}

/* ===== Work Gallery (Before / During / After) ===== */
.phase-filter{display:flex;gap:8px;margin:12px 0 18px;flex-wrap:wrap}
.phase-btn{border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--fg);padding:.55rem .9rem;border-radius:9999px;cursor:pointer}
.phase-btn.is-active{background:var(--accent);color:#0b1220;border-color:transparent;font-weight:700}

.projects{display:grid;grid-template-columns:1fr;gap:14px}
.project-head{padding:12px 14px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.02);border-top-left-radius:16px;border-top-right-radius:16px}
.project-title{margin:0;font-size:18px}
.triptych{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:12px}
.triptych .tile{position:relative;border-radius:14px;overflow:hidden;border:1px solid var(--border);cursor:pointer;margin:0;width:100%}
.triptych .tile img{width:100%;height:220px;object-fit:cover;display:block;transition:transform .25s ease}
.triptych .tile:hover img{transform:scale(1.03)}
.badge{position:absolute;left:8px;top:8px;background:rgba(0,0,0,.6);border:1px solid var(--border);padding:.25rem .5rem;border-radius:9999px;font-size:12px;color:var(--fg)}

/* ===== Lightbox (base) ===== */
.lightbox{
  position:fixed;inset:0;background:rgba(0,0,0,.88);
  display:none;z-index:1050;
  /* mobile-friendly padding incl. iOS safe areas */
  padding:16px env(safe-area-inset-right) calc(24px + env(safe-area-inset-bottom)) env(safe-area-inset-left);
}
.lightbox.open{display:flex;align-items:center;justify-content:center}
.lb-inner{
  position:relative;display:flex;flex-direction:column;align-items:center;
  width:min(100vw - 24px, 980px);
}
.lb-img{
  max-width:100%;
  max-height:calc(100vh - 160px - env(safe-area-inset-bottom));
  object-fit:contain;
  border-radius:16px;border:1px solid var(--border);box-shadow:var(--shadow)
}
.lb-cap{
  margin-top:10px;color:#cbd5e1;text-align:center;max-width:92vw;
  padding:8px 12px;background:rgba(17,24,39,.72);
  border:1px solid var(--border);border-radius:12px;backdrop-filter:blur(6px)
}
/* Floating nav + close so they never push the image */
.lb-nav,.lb-close{
  background:rgba(17,24,39,.9);border:1px solid var(--border);color:var(--fg);
  width:44px;height:44px;border-radius:9999px;display:grid;place-items:center;
  cursor:pointer;box-shadow:var(--shadow);font-size:26px;line-height:1
}
.lb-nav{position:fixed;top:50%;transform:translateY(-50%);margin:0}
.lb-prev{left:12px}
.lb-next{right:12px}
.lb-close{position:fixed;top:calc(12px + env(safe-area-inset-top));right:12px;font-size:22px}

/* ===== Reviews ===== */
.testis{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.quote{padding:14px}
.stars{color:#fbbf24}

/* ===== Booking ===== */
.contactGrid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
form{display:grid;grid-template-columns:1fr 1fr;gap:12px}
label{display:block;margin-bottom:6px;font-size:13px;color:var(--muted)}
input,select,textarea{
  width:100%;padding:.8rem .9rem;border-radius:12px;border:1px solid var(--border);
  background:rgba(255,255,255,.04);color:inherit;font-size:16px;
}
textarea{min-height:120px;grid-column:1/-1}
.actions{display:flex;gap:10px;align-items:center}

/* Input icon */
.input-icon{position:relative;display:block}
.input-icon input{padding-right:42px}
.input-icon .icon{position:absolute;right:12px;top:50%;transform:translateY(-50%);width:20px;height:20px;opacity:.8;pointer-events:none;color:#cbd5e1}

/* Drag & Drop Upload */
.dropzone{border:1px dashed var(--border);background:rgba(255,255,255,.03);border-radius:12px;padding:18px;text-align:center;cursor:pointer;outline:none}
.dropzone:focus{box-shadow:0 0 0 2px rgba(56,189,248,.35)}
.dropzone.dragover{background:rgba(56,189,248,.08);border-color:rgba(56,189,248,.45)}
.preview{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:10px}
.preview-item{position:relative;border:1px solid var(--border);border-radius:10px;overflow:hidden;background:#0b1220}
.preview-item img{width:100%;height:100px;object-fit:cover;display:block}
.preview-item button{position:absolute;top:6px;right:6px;border:1px solid var(--border);background:rgba(0,0,0,.5);color:var(--fg);font-size:12px;line-height:1;padding:.25rem .45rem;border-radius:8px;cursor:pointer}

/* ===== Footer ===== */
footer{margin:46px 0 70px}
.footerGrid{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
.card p{margin:.2rem 0}
.card a{color:inherit;text-decoration:none;border-bottom:1px dashed rgba(255,255,255,.35)}

/* ===== Sticky mobile bar ===== */
.mobile-bar{position:fixed;inset:auto 0 0 0;z-index:999;background:rgba(7,12,24,.96);border-top:1px solid var(--border);padding:10px 12px;gap:10px;display:none}
.mobile-bar a{flex:1;text-align:center;text-decoration:none;color:#0b1220;background:var(--accent);border-radius:12px;padding:.9rem 1rem;font-weight:700;box-shadow:0 6px 20px rgba(56,189,248,.25)}
.mobile-bar a.secondary{background:rgba(255,255,255,.08);color:var(--fg);border:1px solid var(--border);box-shadow:none}

/* ===== Toast ===== */
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:24px;background:rgba(17,24,39,.95);border:1px solid var(--border);color:var(--fg);padding:.8rem 1rem;border-radius:12px;box-shadow:var(--shadow);font-size:14px;display:none;z-index:2000}
.toast.show{display:block}

/* ===== Responsive ===== */
@media (max-width:1100px){.hero{grid-template-columns:1fr}}
@media (max-width:900px){
  .menu-btn{display:inline-flex}
  nav{position:fixed;top:var(--header-h);left:0;right:0;background:rgba(7,12,24,.98);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);flex-direction:column;align-items:flex-start;gap:0;padding:10px 16px;transform:translateY(-16px);opacity:0;pointer-events:none;transition:opacity .2s ease,transform .2s ease}
  nav a{padding:12px 4px;margin:0}
  nav.open{opacity:1;pointer-events:auto;transform:translateY(0)}
  .cta{display:none}
  .grid{grid-template-columns:repeat(2,1fr)}
  .testis{grid-template-columns:repeat(2,1fr)}
  .contactGrid{grid-template-columns:1fr}
  form{grid-template-columns:1fr}
  .footerGrid{grid-template-columns:1fr}
  .heroImg{height:260px}
  .preview{grid-template-columns:repeat(3,1fr)}
}
/* Mobile fixes: align triptych and maximise lightbox height */
@media (max-width:600px){
  .grid,.testis{grid-template-columns:1fr}
  .mobile-bar{display:flex}
  .preview{grid-template-columns:repeat(2,1fr)}
  .triptych{grid-template-columns:1fr;justify-items:stretch}
  .triptych .tile{aspect-ratio:4/3}
  .triptych .tile img{width:100%;height:100%;object-fit:cover;display:block}
  .lb-img{max-height:calc(100vh - 180px - env(safe-area-inset-bottom))}
}
@media (prefers-reduced-motion:reduce){*{scroll-behavior:auto}.triptych .tile img{transition:none}}
</style>
</head>
<body>
<header class="header" id="site-header">
  <div class="wrap">
    <button class="menu-btn" aria-label="Toggle menu" aria-controls="mainnav" aria-expanded="false">
      <svg viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M3 6h18M3 12h18M3 18h18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
    </button>
    <div class="brand">
      <img class="brand-logo" src="./images/et-handyman-logo.jpg" alt="ET Handyman logo" width="28" height="28">
      ET Handyman Services
    </div>
    <div class="spacer"></div>
    <nav id="mainnav" aria-label="Main navigation">
      <a href="#services">Services</a>
      <a href="#work">Our Work</a>
      <a href="#reviews">Reviews</a>
      <a href="#booking">Book</a>
    </nav>
    <a class="cta" href="https://www.facebook.com/profile.php?id=61559444704457&sk=about" target="_blank" rel="noopener">Facebook</a>
    <a class="cta" href="https://wa.me/447305848484" target="_blank" rel="noopener">WhatsApp</a>
  </div>
</header>

<!-- Hero -->
<section class="hero" id="top">
  <div>
    <h1>Trusted Handyman Services in Brighton & Peacehaven</h1>
    <p>Roofing, tiling, landscaping, resin driveways, decorating and more — reliable, insured, and friendly.</p>
    <div class="buttons">
      <a class="btn primary" href="#booking">Book a Job</a>
      <a class="btn" href="#work">View Past Work</a>
    </div>
  </div>
  <aside class="heroCard">
    <img class="heroImg" src="./images/work-1.jpg" alt="Outdoor porcelain tiling project" loading="eager" width="1200" height="800">
  </aside>
</section>

<!-- Services -->
<section class="section" id="services" tabindex="-1">
  <h2>What we do</h2>
  <p class="muted">Professional workmanship across exterior and interior projects.</p>
  <div class="grid">
    <article class="card svc"><img src="./images/Roofing repairs.jpg" alt="Roof repair" loading="lazy" width="240" height="240"><div><h3>Roofing & Repairs</h3><p>Tile/slate replacement, valleys & lead flashing, underlay & battens, gutters and leaks.</p></div></article>
    <article class="card svc"><img src="./images/Tiling7.jpg" alt="Tiling" loading="lazy" width="240" height="240"><div><h3>Tiling & Paving</h3><p>Indoor/outdoor tiling, patios & steps, porcelain/ceramic, grouting and levelling.</p></div></article>
    <article class="card svc"><img src="./images/Grandting3.jpg" alt="Driveway" loading="lazy" width="240" height="240"><div><h3>Driveways & Resin</h3><p>Resin-bound finishes, edging and drainage for durable, low-maintenance driveways.</p></div></article>
    <article class="card svc"><img src="./images/Landscaping3.jpg" alt="Landscaping" loading="lazy" width="240" height="240"><div><h3>Landscaping & Groundworks</h3><p>Garden clearance, paths & edging, gravel/turf, levels and makeovers.</p></div></article>
    <article class="card svc"><img src="./images/painting.jpg" alt="Painting" loading="lazy" width="240" height="240"><div><h3>Painting & Decorating</h3><p>Walls, ceilings and woodwork with careful prep and tidy finishes.</p></div></article>
    <article class="card svc"><img src="./images/Carpeting.jpg" alt="Carpet" loading="lazy" width="240" height="240"><div><h3>Carpets & Flooring</h3><p>Carpet supply & fit, underlay, trimming and room restoration.</p></div></article>
  </div>
</section>

<!-- Work Gallery -->
<section class="section" id="work" tabindex="-1">
  <h2>What we’ve done</h2>
  <p class="muted">Each project shows a clear Before → During → After sequence. Filter by phase or open any image to view.</p>

  <div class="phase-filter" role="toolbar" aria-label="Filter by phase">
    <button class="phase-btn is-active" data-phase="all" aria-pressed="true">All</button>
    <button class="phase-btn" data-phase="before" aria-pressed="false">Before</button>
    <button class="phase-btn" data-phase="during" aria-pressed="false">During</button>
    <button class="phase-btn" data-phase="after" aria-pressed="false">After</button>
  </div>

  <div class="projects">
    <!-- Project examples (p1–p7) -->
    <article class="card project" data-project="p3">
      <header class="project-head"><h3 class="project-title">Garden clearance <span class="muted">— Hove</span></h3></header>
      <div class="triptych">
        <figure class="tile phase-before">
          <img src="./images/Weeding Before.jpg" alt="Before — Garden clearance in Hove" data-cap="BEFORE — Garden clearance — Hove" data-project="p3" data-phase="before" width="1000" height="700">
          <span class="badge">Before</span>
        </figure>
        <figure class="tile phase-during">
          <img src="./images/Weeding During.jpg" alt="During — Garden clearance in Hove" data-cap="DURING — Garden clearance — Hove" data-project="p3" data-phase="during" width="1000" height="700">
          <span class="badge">During</span>
        </figure>
        <figure class="tile phase-after">
          <img src="./images/Weeding After.jpg" alt="After — Garden clearance in Hove" data-cap="AFTER — Garden clearance — Hove" data-project="p3" data-phase="after" width="1000" height="700">
          <span class="badge">After</span>
        </figure>
      </div>
    </article>

    <!-- Add your other projects here exactly as before (p1, p2, p4–p7) -->
  </div>

  <!-- Lightbox -->
  <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Image viewer">
    <button class="lb-nav lb-prev" aria-label="Previous image">‹</button>
    <div class="lb-inner">
      <img class="lb-img" id="lbImg" alt="">
      <div class="lb-cap" id="lbCap"></div>
      <button class="lb-close" aria-label="Close">×</button>
    </div>
    <button class="lb-nav lb-next" aria-label="Next image">›</button>
  </div>
</section>

<!-- Reviews -->
<section class="section" id="reviews" tabindex="-1">
  <h2>What customers say</h2>
  <div class="testis">
    <article class="card quote"><div class="stars">★★★★★</div><p>“ET Handyman Services are the best in Brighton — great job and great service.”</p><p class="muted">— Mohammed Asif, Peacehaven</p></article>
    <article class="card quote"><div class="stars">★★★★★</div><p>“Amazing service — painting, decorating, tiling, gardening. ❤️”</p><p class="muted">— Amir Ali, Brighton</p></article>
    <article class="card quote"><div class="stars">★★★★★</div><p>“Friendly and professional — will book again.”</p><p class="muted">— Louise, Hove</p></article>
  </div>
</section>

<!-- Booking -->
<section class="section" id="booking" tabindex="-1">
  <h2>Book a job</h2>
  <div class="contactGrid">
    <div class="card" style="padding:16px">
      <form id="quoteForm" novalidate>
        <div><label for="fullName">Full name</label><input id="fullName" name="fullName" required placeholder="Jane Doe" autocomplete="name"></div>
        <div><label for="phone">Phone</label><input id="phone" name="phone" required placeholder="+44" autocomplete="tel"></div>
        <div><label for="email">Email</label><input id="email" name="email" type="email" placeholder="you@example.com" autocomplete="email" required></div>
        <div><label for="postcode">Postcode</label><input id="postcode" name="postcode" required placeholder="BN10 7FB" autocomplete="postal-code"></div>
        <div><label for="service">Service</label>
          <select id="service" name="service" required>
            <option value="">Select…</option>
            <option>Roofing & Repairs</option>
            <option>Tiling & Paving</option>
            <option>Driveways & Resin</option>
            <option>Landscaping & Groundworks</option>
            <option>Painting & Decorating</option>
            <option>Carpets & Flooring</option>
            <option>Small Plumbing / Bathroom</option>
          </select>
        </div>

        <div>
          <label for="date">Preferred date</label>
          <div class="input-icon">
            <input id="date" name="date" type="text" placeholder="Select a date" aria-label="Preferred date">
            <svg class="icon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="1.8"/>
              <path d="M8 2v4M16 2v4M3 10h18" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
            </svg>
          </div>
        </div>

        <div style="grid-column:1/-1">
          <label for="message">Job details</label>
          <textarea id="message" name="message" placeholder="Describe the job, access, parking, links to photos, etc." required></textarea>
        </div>

        <div style="grid-column:1/-1">
          <label for="photos">Photos (optional)</label>
          <div id="dropzone" class="dropzone" role="button" tabindex="0" aria-label="Upload photos">
            <p>Click to upload or drag and drop up to 5 photos</p>
            <p class="muted" style="font-size:12px;margin-top:4px">JPG, PNG, HEIC/HEIF, WebP • Max 4 MB each</p>
          </div>
          <input id="photos" name="photos" type="file" accept="image/*" capture="environment" multiple hidden />
          <div id="preview" class="preview" aria-live="polite"></div>
        </div>

        <input type="text" name="company" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px;opacity:0">
        <div class="actions" style="grid-column:1/-1">
          <button class="btn primary" id="quoteSubmit" type="submit">Request quote</button>
          <span class="muted" id="formMsg" style="font-size:12px" aria-live="polite"></span>
        </div>
      </form>
    </div>
    <aside class="card" style="padding:16px">
      <h3 style="margin-top:0">Contact</h3>
      <p><strong>Phone:</strong> <a href="tel:+447305848484">+44 7305 848484</a></p>
      <p><strong>Email:</strong> <a href="mailto:eli_etremovals@proton.me">eli_etremovals@proton.me</a></p>
      <p><strong>WhatsApp:</strong> <a href="https://wa.me/447305848484" target="_blank" rel="noopener">Chat now</a></p>
      <p><strong>Facebook:</strong> <a href="https://www.facebook.com/profile.php?id=61559444704457&sk=about" target="_blank" rel="noopener">Visit our Facebook</a></p>
      <p class="muted">Service area: Peacehaven · Brighton & Hove · East Sussex</p>
    </aside>
  </div>
</section>

<!-- Footer -->
<footer class="section">
  <div class="footerGrid">
    <div class="card" style="padding:14px 16px"><h4>Address</h4><p>ET Handyman Services<br>2 Lincoln Court, Lincoln Avenue<br>Peacehaven BN10 7FB, UK</p></div>
    <div class="card" style="padding:14px 16px"><h4>Hours</h4><p>Mon–Sat: 8:00–19:00<br>Sun: By appointment</p></div>
    <div class="card" style="padding:14px 16px"><h4>Legal</h4><p class="muted" style="font-size:12px">© <span id="year"></span> ET Handyman Services</p></div>
  </div>
</footer>

<!-- Sticky mobile action bar (phones only) -->
<div class="mobile-bar" role="group" aria-label="Quick actions">
  <a href="tel:01273 569343">Call</a>
  <a class="secondary" href="https://wa.me/447305848484" target="_blank" rel="noopener">WhatsApp</a>
</div>

<!-- Toast -->
<div class="toast" id="toast" role="status" aria-live="polite"></div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
// ===== Header offset
const headerEl = document.getElementById('site-header');
function setHeaderOffset(){
  const h = headerEl.getBoundingClientRect().height;
  document.documentElement.style.setProperty('--header-h', (h+6)+'px');
  document.body.style.paddingTop = h + 'px';
}
setHeaderOffset();
addEventListener('resize', setHeaderOffset);

// Year
document.getElementById('year').textContent = new Date().getFullYear();

// Mobile nav toggle
const menuBtn = document.querySelector('.menu-btn');
const nav = document.getElementById('mainnav');
menuBtn.addEventListener('click', ()=>{
  const open = nav.classList.toggle('open');
  menuBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
});
nav.addEventListener('click', e=>{
  if(e.target.tagName === 'A' && nav.classList.contains('open')){
    nav.classList.remove('open');
    menuBtn.setAttribute('aria-expanded','false');
  }
});

// Calendar popup
document.addEventListener('DOMContentLoaded', function(){
  if (window.flatpickr) {
    flatpickr("#date", { dateFormat: "Y-m-d", altInput: true, altFormat: "D, j M Y", minDate: "today", disableMobile: true });
  }
});

// ===== Drag & Drop photos
const dropzone = document.getElementById('dropzone');
const photosInput = document.getElementById('photos');
const previewEl = document.getElementById('preview');
let selectedFiles = [];

function toast(msg){
  const t = document.getElementById('toast');
  t.textContent = msg; t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'), 4000);
}

if (dropzone && photosInput && previewEl) {
  dropzone.addEventListener('click', () => photosInput.click());
  dropzone.addEventListener('keydown', (e) => {
    if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); photosInput.click(); }
  });
  ['dragenter','dragover'].forEach(evt => {
    dropzone.addEventListener(evt, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.add('dragover'); });
  });
  ['dragleave','drop'].forEach(evt => {
    dropzone.addEventListener(evt, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('dragover'); });
  });
  dropzone.addEventListener('drop', (e) => addFiles(Array.from(e.dataTransfer.files || [])));
  photosInput.addEventListener('change', () => addFiles(Array.from(photosInput.files || [])));
}

const MAX_FILES = 5;
const MAX_MB_PER_FILE = 4;

function addFiles(files){
  for(const f of files){
    if (selectedFiles.length >= MAX_FILES) { toast(`You can upload up to ${MAX_FILES} images.`); break; }
    const mb = f.size / (1024*1024);
    if (mb > MAX_MB_PER_FILE) { toast(`"${f.name}" is ${mb.toFixed(1)} MB. Max ${MAX_MB_PER_FILE} MB each.`); continue; }
    if (f.type && !(f.type.startsWith('image/'))) { toast(`"${f.name}" is not an image.`); continue; }
    const key = f.name + ':' + f.size + ':' + f.lastModified;
    if (selectedFiles.some(sf => (sf.name + ':' + sf.size + ':' + sf.lastModified) === key)) continue;
    selectedFiles.push(f);
  }
  updatePreview(); syncInputWithSelection();
}

function updatePreview(){
  previewEl.innerHTML = '';
  selectedFiles.forEach((file, idx) => {
    const url = URL.createObjectURL(file);
    const item = document.createElement('div');
    item.className = 'preview-item';
    item.innerHTML = `<img src="${url}" alt="Selected photo ${idx+1}"><button type="button" aria-label="Remove photo ${idx+1}">×</button>`;
    item.querySelector('button').addEventListener('click', () => {
      selectedFiles.splice(idx, 1); updatePreview(); syncInputWithSelection();
    });
    previewEl.appendChild(item);
  });
}

function syncInputWithSelection(){
  const dt = new DataTransfer();
  selectedFiles.forEach(f => dt.items.add(f));
  photosInput.files = dt.files;
}

// File to Base64 for serverless email
function readFileAsBase64(file){
  return new Promise((resolve, reject)=>{
    const reader = new FileReader();
    reader.onload = () => {
      const base64 = String(reader.result).split(',')[1];
      resolve({ filename: file.name, content_type: file.type || 'application/octet-stream', base64 });
    };
    reader.onerror = () => reject(new Error('Failed to read file'));
    reader.readAsDataURL(file);
  });
}

async function collectAttachments(inputEl){
  const files = Array.from(inputEl.files || []);
  if(!files.length) return [];
  return Promise.all(files.map(readFileAsBase64));
}

// ===== Quote form submit (example endpoint)
(function(){
  const form = document.getElementById('quoteForm');
  if(!form) return;
  const statusEl = document.getElementById('formMsg');
  const submitBtn = document.getElementById('quoteSubmit');

  function validate(p){
    if(!p.fullName?.trim()) return 'Please enter your name';
    if(!/^\S+@\S+\.\S+$/.test(p.email||'')) return 'Please enter a valid email';
    if(!p.phone?.trim()) return 'Please enter your phone';
    if(!(p.address || p.postcode)?.trim()) return 'Please enter your postcode';
    if(!p.service) return 'Please select a service';
    if(!p.message?.trim()) return 'Please describe the job';
    return null;
  }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    statusEl.textContent = '';
    submitBtn.disabled = true;

    const fd = new FormData(form);
    const payload = Object.fromEntries(Array.from(fd.entries()).filter(([k]) => k !== 'photos'));

    const err = validate(payload);
    if(err){ statusEl.textContent = err; submitBtn.disabled = false; return; }

    try{
      const attachments = await collectAttachments(document.getElementById('photos'));
      if(attachments.length){ payload.attachments = attachments; }

      const res = await fetch('/.netlify/functions/quote-request', {
        method: 'POST',
        headers: {'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      const text = await res.text();
      let data = {}; try { data = JSON.parse(text); } catch {}
      if(!res.ok) throw new Error(data?.error || text || 'Submission failed');

      statusEl.textContent = 'Thanks! Your quote request has been received.';
      toast('Request sent ✔');
      form.reset();
      selectedFiles = [];
      updatePreview();
      const fp = document.getElementById('date')._flatpickr; if(fp) fp.clear();
    }catch(e){
      statusEl.textContent = e?.message?.includes('images') ? e.message : 'Sorry, something went wrong. Please try again or call 01273 569343.';
      toast('Could not send. Please try again.');
      console.error(e);
    }finally{
      submitBtn.disabled = false;
    }
  });
})();

// ===== Work Gallery: Phase Filter + Lightbox (group per project)
const phaseButtons = Array.from(document.querySelectorAll('.phase-btn'));
function setPhaseFilter(phase){
  phaseButtons.forEach(b=>{
    const active = b.dataset.phase === phase;
    b.classList.toggle('is-active', active);
    b.setAttribute('aria-pressed', active ? 'true' : 'false');
  });
  document.querySelectorAll('.project').forEach(project=>{
    project.querySelectorAll('.triptych figure').forEach(fig=>{
      const isMatch = (phase === 'all') || fig.classList.contains('phase-' + phase);
      fig.style.display = isMatch ? '' : 'none';
    });
  });
}
phaseButtons.forEach(b=> b.addEventListener('click', ()=> setPhaseFilter(b.dataset.phase)));
setPhaseFilter('all');

const lb = document.getElementById('lightbox');
const lbImg = document.getElementById('lbImg');
const lbCap = document.getElementById('lbCap');
const prevBtn = lb.querySelector('.lb-prev');
const nextBtn = lb.querySelector('.lb-next');
const closeBtn = lb.querySelector('.lb-close');

let currentGroup = []; // array of {src, cap, el}
let currentIndex = 0;

function openGroupFrom(imgEl){
  const projectId = imgEl.dataset.project;
  const container = document.querySelector(`.project[data-project="${projectId}"]`);
  if(!container) return;

  // only visible figures (respect current phase filter)
  const items = Array.from(container.querySelectorAll('.triptych figure'))
    .filter(fig => fig.style.display !== 'none')
    .map(fig => {
      const i = fig.querySelector('img');
      return { el: i, src: i.src, cap: i.dataset.cap || '' };
    });

  currentGroup = items;
  currentIndex = items.findIndex(it => it.el === imgEl);
  if(currentIndex < 0) currentIndex = 0;
  showIndex(currentIndex);
  lb.classList.add('open');

  // Prevent background scroll while open
  document.body.style.overflow = 'hidden';
}

function showIndex(i){
  if(!currentGroup.length) return;
  currentIndex = (i + currentGroup.length) % currentGroup.length;
  const it = currentGroup[currentIndex];
  lbImg.src = it.src;
  lbCap.textContent = it.cap;
}

function closeLightbox(){
  lb.classList.remove('open');
  currentGroup = [];
  document.body.style.overflow = '';
}

document.getElementById('work').addEventListener('click', (e)=>{
  const img = e.target.closest('.triptych img');
  if(!img) return;
  openGroupFrom(img);
});

// Backdrop click: close if click is NOT inside inner content or on nav buttons
lb.addEventListener('click', (e)=>{
  const inside = e.target.closest('.lb-inner, .lb-nav');
  if(!inside) closeLightbox();
});

prevBtn.addEventListener('click', (e)=>{ e.stopPropagation(); showIndex(currentIndex - 1); });
nextBtn.addEventListener('click', (e)=>{ e.stopPropagation(); showIndex(currentIndex + 1); });
if (closeBtn) closeBtn.addEventListener('click', (e)=>{ e.stopPropagation(); closeLightbox(); });

// Keep Esc + arrows
addEventListener('keydown', (e)=>{
  if(!lb.classList.contains('open')) return;
  if(e.key === 'Escape') closeLightbox();
  if(e.key === 'ArrowLeft') showIndex(currentIndex - 1);
  if(e.key === 'ArrowRight') showIndex(currentIndex + 1);
});

// --- Swipe to navigate on touch devices ---
(function(){
  let tsX = 0, tsY = 0;
  lb.addEventListener('touchstart', e => {
    const t = e.touches[0]; tsX = t.clientX; tsY = t.clientY;
  }, {passive:true});
  lb.addEventListener('touchend', e => {
    const t = e.changedTouches[0];
    const dx = t.clientX - tsX, dy = t.clientY - tsY;
    if (Math.abs(dx) > 40 && Math.abs(dy) < 80) {
      if (dx < 0) showIndex(currentIndex + 1);
      else showIndex(currentIndex - 1);
    }
  }, {passive:true});
})();
</script>
</body>
</html>
